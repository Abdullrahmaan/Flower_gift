<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Personalized Flower Gift</title>

    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Load Firebase SDKs (v9 syntax via CDN for the script.js logic) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, query, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        
        // Expose Firebase components globally for use in the non-module script.js
        window.firebase = {
            initializeApp,
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged,
            getFirestore, doc, onSnapshot, collection, query, setDoc, getDoc, setLogLevel
        };
    </script>
    
    <!-- Tone.js for optional music/sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>

    <link rel="stylesheet" href="style.css">
    
    <style>
        /* Ensure canvas is responsive while maintaining the pixelated look */
        #garden-canvas {
            display: block;
            width: 100%; /* Fill container width */
            max-width: 900px; /* Optional max width */
            height: auto; /* Maintain aspect ratio */
            image-rendering: pixelated;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- Garden/Flower View Toggle Button -->
    <button id="garden-button" class="fixed top-4 right-4 bg-gray-700 text-white p-3 rounded-xl shadow-lg hover:bg-gray-800 transition duration-300 z-50">
        View Garden
    </button>

    <!-- The Gift Builder Link (Hidden by default, used only in builder.html) -->
    <a href="index.html" id="builder-link" class="fixed top-4 left-4 bg-blue-500 text-white p-3 rounded-xl shadow-lg hover:bg-blue-600 transition duration-300 z-50 hidden">
        Create Your Own Gift
    </a>
    
    <!-- View 1: The Interactive Flower Gift -->
    <div id="flower-view" class="flex flex-col items-center justify-center p-4">
        <div id="initial-state" class="container bg-white p-8 rounded-3xl shadow-2xl flex flex-col items-center justify-center text-center mt-20">
            <h1 id="watering-instruction" class="text-3xl font-extrabold text-[#7B68EE] mb-4">
                Water Your Seed!
            </h1>
            <p id="sender-message" class="text-lg text-gray-600 mb-6 italic">
                Awaiting your touch...
            </p>

            <img id="watering-can" src="https://placehold.co/100x100/A0DAA9/FFFFFF?text=Can" alt="Watering Can" class="w-24 h-24 cursor-pointer transform transition duration-200 active:scale-95">
            <img id="main-flower-pre" src="https://placehold.co/50x50/34D17F/FFFFFF?text=Seed" alt="The Seed" class="w-12 h-12 my-6 transition-all duration-1000">

            <div id="click-counter-display" class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full font-semibold mt-4">
                <span id="current-clicks">0</span> / <span id="required-clicks">3</span>
            </div>

            <p class="text-sm mt-4 text-gray-500">
                Click the watering can <span id="required-clicks-text">3</span> times to make the flower bloom!
            </p>
        </div>

        <!-- Gift Reveal State (Initially hidden) -->
        <div id="gift-reveal" class="container bg-white p-8 rounded-3xl shadow-2xl flex flex-col items-center justify-center text-center mt-20 hidden">
            <h2 class="text-3xl font-bold text-green-700 mb-4 animate-pulse">It Bloomed!</h2>
            <img id="main-flower" src="https://placehold.co/200x200/F08080/FFFFFF?text=Rose" alt="The Gift Flower" class="w-48 h-48 transform scale-0 transition-transform duration-1000 ease-out">
            
            <!-- Message Box -->
            <div class="bg-gray-50 p-6 rounded-xl shadow-inner mt-6 border-4 border-[#7B68EE] w-full">
                <p id="personal-message" class="text-md italic text-gray-700 font-medium"></p>
            </div>
            
            <!-- Sparkle Effect Overlay -->
            <div id="sparkle-overlay" class="absolute inset-0"></div>
        </div>
    </div>

    <!-- View 2: The Flower Garden Collection -->
    <div id="garden-view" class="hidden">
        <h1 class="text-4xl font-extrabold text-white my-8 drop-shadow-lg">Your Personal Garden</h1>
        <p class="text-white text-lg mb-8">
             Click any flower in your garden to see its personalized message and date received.
        </p>

        <!-- Canvas for the Pixel Garden -->
        <div id="pixel-garden-container" class="max-w-full w-[95%] sm:w-[80%] lg:w-[600px] mx-auto">
            <canvas id="garden-canvas" width="600" height="400" class="shadow-2xl"></canvas>
        </div>
    </div>

    <!-- ========================================================================= -->
    <!-- MODAL FOR FLOWER DETAILS -->
    <!-- ========================================================================= -->
    <div id="flower-modal" class="fixed inset-0 hidden modal flex items-center justify-center p-4">
        <!-- Modal Backdrop -->
        <div class="fixed inset-0 bg-black opacity-60 modal-close-backdrop"></div>
        <!-- Modal Content -->
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl relative transform transition-all duration-300 scale-100 z-10">
            <button class="close-button absolute top-2 right-4 text-gray-500 hover:text-gray-900 text-3xl font-light leading-none">&times;</button>
            <h3 id="modal-flower-name" class="text-2xl font-bold text-[#7B68EE] mb-2">Flower Name</h3>
            <p id="modal-flower-date" class="text-sm text-gray-500 mb-4"></p>
            <hr class="mb-4 border-gray-200">
            <p id="modal-flower-message" class="text-gray-700 italic text-md"></p>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC (Main App Script) -->
    <script src="script.js"></script>
</body>
</html>
